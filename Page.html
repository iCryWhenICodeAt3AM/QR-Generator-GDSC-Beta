<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Styling</title>
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      #message{
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #canvas {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh; /* Optionally, set the desired height */
        border: 4px solid red; /* Set the initial border color to red */
      }
    </style>
</head>
<body>
   <h1 id="message"></h1>
    <div id="canvas"></div>
    <script type="text/javascript">
    google.script.run.withSuccessHandler(() => generateQR(counter)).doGet();

    function waitForCanvasToLoad(callback) {
        var interval = setInterval(function() {
            var canvasElement = document.querySelector("#canvas canvas");
            if (canvasElement) {
                clearInterval(interval); // Stop checking
                callback(canvasElement);
            }
        }, 100); // Check every 100 milliseconds
    }

    let counter = 0;
    let data = "<?= data ?>";
    const dataArray = data.split(",");

    function generateQR(number) {
      $('#message').text("SAVING TO DRIVE...");
      $('#canvas').css('border-color', 'red');
      $('#canvas').empty();
      // console.log(dataArray);
      const qrCode = new QRCodeStyling({
        width: 600,
        height: 600,
        type: "canvas",
        data: dataArray[number], // Use the counter to dynamically access data
        image: "https://i.ibb.co/ZzBFw8k/birb.png",
        dotsOptions: {
          color: "#000000",
          type: "rounded"
        },
        backgroundOptions: {
          color: "#ffffff",
        },
        imageOptions: {
          crossOrigin: "anonymous",
          margin: 10
        }
        
      });

      qrCode.append(document.getElementById("canvas"));
      waitForCanvasToLoad(passQRToSave);
    }

    function passQRToSave(canvasElement) {
        if (canvasElement) {
            var img = canvasElement.toDataURL('image/png');
            // The rest of your code
            google.script.run.withSuccessHandler(function(fileName) {
            // Change the border color to green on success
            $('#canvas').css('border-color', 'green');
            $('#message').text("Saved to Drive as "+fileName);
            generateNextQR();
        }).withFailureHandler(function(error) {
            // Display an alert with the error message
            $('#message').text("SAVED TO DRIVE AS "+fileName);
            alert("Error saving QR code to Drive: " + error);
        }).saveQRCodeToDrive(img);
        } else {
            alert("QR code not found. Please generate the QR code first.");
        }
    }
  
    function generateNextQR() {
      
      counter++;
      google.script.run.withSuccessHandler(() => generateQR(counter)).doGet();
    }
    </script>
</body>
</html>
